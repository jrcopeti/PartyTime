<% if current_user %>
 <h2><%= current_user.email %></h2>
    <%= image_tag(current_user.avatar_url) if !current_user.avatar_url.nil? %>
    <%= link_to "Edit Account", edit_user_registration_path %>
    <%= button_to "Logout", destroy_user_session_path, data: {turbo: "false"}, method: :delete %>
  <% else %>
    <%= link_to "Login", new_user_session_path %>
  <% end %>

<%= link_to "Create Events", new_event_path %>

<div class="container">
  <h1>Events</h1>

  <%= form_with url: events_path, method: :get, class: "d-flex" do %>
    <%= text_field_tag :query, params[:query], class: "form-control", placeholder: "Find a Event"
    %>
    <%= submit_tag "Search", class: "btn btn-primary" %>
  <% end %>

  <div>
    <% prev_date = nil %>
    <% @events_by_date.each do |date, events| %>
      <% if prev_date != date.to_date.strftime("%A, %B %e, %Y") %>
        <% prev_date = date.to_date.strftime("%A, %B %e, %Y") %>
        <div>
          <h3> <%= prev_date %> </h3>
          <div>
            <br>
      <% end %>
      <% events.each do |event| %>
        <h2><%= link_to event.title, venue_event_path(event.venue_id, event.id) %></h2>
        <ul>
          From <%= event.start_date.strftime("%I:%M %p") %> to <%= event.end_date.strftime("%I:%M %p") %></li>
        </ul>
      <% end %>
      <% if @events_by_date.keys.last == date %>
      <% end %>
    <% end %>
    </div>

    <%= link_to "Back to home", root_path %>
    </div>
